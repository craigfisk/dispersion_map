{% extends "forum/fbase.html" %}        

{% block title %}Myfruitcake{% endblock %}

{% block sidebar %} - my shipments{% endblock %} 


{# (shipment_list.html) #}

{% load tz %} 


{% block page-content %}
    <div class="main">
        <div id="rtitle">Upload a fruitcake photo? <span class="menu"><a href="/myfruitcake/upload/">Upload</a></span></div>
    </div>


    {% block myfruitcakelist %}{% endblock myfruitcakelist %}        

    {# and user.is_authenticated #}

    {# <P>Shipment_list.html for {{ user.id }}</P> #}

    {% if shipment_list %}

        <br />
        <P class="main">Listing of shipment(s) 
        {% if sender  %}
         Sent by <i><u>{{ sender }}</u></i>
         {% endif %}
         (<b>click photo to send</b>):</P>

        <div id="gallery_tape">
        <ul class="gallery tape">


        {% if shipment_list %}
            {% for shipment in shipment_list %}

              {# shipment_list is dt desc of origin_id, parent_id, id, etc. and we want just the max id for each origin_id, so... #}
              {% ifchanged shipment.origin_id %}

                <table><tr>
                        {# <li> #}
                <td valign="top">

                <figure>
                    <a href="/myfruitcake/myfruitcake/myshipments{{ shipment.id }}/send/" title="{{ shipment.fruitcake.popup }}">
                        <img src="{{ MEDIA_URL }}{{ shipment.fruitcake.thumbnail }}"/>
                    </a>
                    <figcaption>uploaded: {{ shipment.fruitcake.dt|localtime }}<br />by: {{ shipment.fruitcake.uploader.username }} (sent {{shipment.fruitcake.times_shipped}}x)</figcaption>
                </figure>
                </td>

                <td border="1" valign="top" width="100%" height="100%">

                {% comment %}
                
                <b>Map: {{ shipment.get_shipment_list | length }}, iteration: {{ forloop.counter0 }}</b>

                {% if forloop.counter0 == 0 %}
                    <P>counter0 here</P>
                    <div id="map-canvas">Map</div>

                {% else %}
                {% endif %}

                {% endcomment %}

                {% if shipment.get_shipment_list %}

                <BR />
                <u>Latest</u>
                    <ol class="history_area" reversed >
                    {% for leg in shipment.get_shipment_list %}
                    <li class="history_item">
                    - <i>({{leg.origin_id}}, {{leg.parent_id}}, {{ leg.id }})</i> {{ leg.dt|localtime }} 
                    {#sent by <b><span {% if leg.sender_id == user.id %}style="color: red;">{% endif %}{{ leg.sender }}</span>#}
                        sent by 
                        <b><span 
                                {% if leg.sender_id == user.id %}
                                    class='highlight'
                                {% else %}
                                    class='otherhighlight'
                                {% endif %}
                                >{{ leg.sender }}
                        </span>

                        {% for ip in leg.ipaddresses.all %}
                        ({{ ip.city }}, {{ ip.region }}, {{ ip.country_name }}{# - {{ ip.ipaddress }}#}) 
                        {% endfor %}</b>
                        with message &quot;{{ leg.message }}&quot;
                        <br />
                        {% if leg.sender = user %}
                        --> sent to: 
                            {% for email in leg.emailcontacts.all %} 
                                {{email }}{% if not forloop.last %}, {% endif %} 
                            {% endfor %} 
                        {% endif %}
                    </li>
                    {% endfor %}
                    </ol>

                    <u>Start</u>

                {% else %}
                    <b>no list</b>
                {% endif %}

                {# endcomment #}


                </td>
                {# </li> #}
                </tr></table>
           
              {% endifchanged %}

            {% endfor %}

        {% else %}

            <P>Here is your map</P>
    
        {% endif %}


        </ul>
        </div>
        {#  <br />by: {{ shipment.uploader.username }} #}
     {% else %}
        {# <div id="map-canvas">Map</div> #}

        (Sorry, looks like you have not shipped any fruitcake, yet.)
     {% endif %}


{% endblock %}


{% comment %}
{% block page-content %}


{% endblock %}

{% endcomment %}

